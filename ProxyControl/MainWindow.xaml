<Window x:Class="ProxyControl.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ProxyControl"
        xmlns:vm="clr-namespace:ProxyControl.ViewModels"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:models="clr-namespace:ProxyControl.Models"
        mc:Ignorable="d"
       Title="WPF Proxy Router" Height="600" Width="900">
   
   
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <ObjectDataProvider x:Key="BlackListTypes" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="models:BlackListType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <GroupBox Header="Proxies" Grid.Column="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Button Command="{Binding AddProxyCommand}" Content="Add Proxy" Margin="5"/>

                <ListBox Grid.Row="1" ItemsSource="{Binding Proxies}" SelectedItem="{Binding SelectedProxy}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <CheckBox IsChecked="{Binding IsEnabled}" Command="{Binding DataContext.ToggleProxyCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                <TextBlock Text="{Binding IpAddress}" Margin="5,0"/>
                                <TextBlock Text=":" />
                                <TextBlock Text="{Binding Port}" Margin="5,0"/>
                                <TextBlock Text="[" Foreground="Gray"/>
                                <TextBlock Text="{Binding Status}" Foreground="Blue"/>
                                <TextBlock Text="]" Foreground="Gray"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <StackPanel Grid.Row="2" Margin="5">
                    <TextBlock Text="Edit Selected:" FontWeight="Bold"/>
                    <TextBox Text="{Binding SelectedProxy.IpAddress, UpdateSourceTrigger=PropertyChanged}" Margin="0,2"/>
                    <TextBox Text="{Binding SelectedProxy.Port, UpdateSourceTrigger=PropertyChanged}" Margin="0,2"/>
                    <TextBox Text="{Binding SelectedProxy.Username, UpdateSourceTrigger=PropertyChanged}"  Margin="0,2" ToolTip="Username"/>
                    <TextBox Text="{Binding SelectedProxy.Password, UpdateSourceTrigger=PropertyChanged}" Margin="0,2" ToolTip="Password"/>
                    <Button Command="{Binding CheckProxyCommand}" Content="Check Connection" Margin="0,5"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <GroupBox Header="Routing Rules" Grid.Column="1" Margin="10,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" Margin="5">
                    <RadioButton Content="BlackList Mode (Single Proxy)" IsChecked="{Binding IsBlackListMode}" Margin="0,0,10,0"/>
                    <!--IsChecked="{Binding IsBlackListMode, Converter={local:InverseBooleanConverter}}"-->
                    <RadioButton Content="WhiteList Mode (Multi Proxy)" />
                </StackPanel>

                <!--Visibility="{Binding IsBlackListMode, Converter={local:BooleanToVisibilityConverter}}"-->
                <Grid Grid.Row="1" >
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel>
                        <TextBlock Text="Select Rule Logic:" Margin="0,5"/>
                        <ComboBox ItemsSource="{Binding Source={StaticResource BlackListTypes}}" SelectedItem="{Binding SelectedBlackListType}"/>
                    </StackPanel>

                    <Grid Grid.Row="1" Margin="0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <GroupBox Header="Excluded Apps (Process Name)">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBox Width="150" Text="{Binding NewExcludedApp, UpdateSourceTrigger=PropertyChanged}"/>
                                    <Button Content="Add" Command="{Binding AddBlackListAppCommand}"/>
                                </StackPanel>
                                <ListBox Grid.Row="1" ItemsSource="{Binding BlackListApps}"/>
                            </Grid>
                        </GroupBox>

                        <GroupBox Header="Excluded Sites (Host)" Grid.Column="1" Margin="5,0,0,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBox Width="150" Text="{Binding NewExcludedSite, UpdateSourceTrigger=PropertyChanged}"/>
                                    <Button Content="Add" Command="{Binding AddBlackListSiteCommand}"/>
                                </StackPanel>
                                <ListBox Grid.Row="1" ItemsSource="{Binding BlackListSites}"/>
                            </Grid>
                        </GroupBox>
                    </Grid>
                </Grid>

                <!--Visibility="{Binding IsBlackListMode, Converter={local:InverseBooleanToVisibilityConverter}}"-->
                <Grid Grid.Row="1" >
                    <TextBlock Text="В режиме WhiteList правила применяются к каждому прокси отдельно. Логика реализована в ProxyService, интерфейс добавления правил аналогичен BlackList." 
                               TextWrapping="Wrap" Margin="10" Foreground="Gray"/>
                </Grid>

            </Grid>
        </GroupBox>
    </Grid>
</Window>
